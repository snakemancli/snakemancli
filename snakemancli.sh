#!/bin/bash

# Environment variables
export OPENAI_API_KEY="sk-pppppppprrrrrrrooooooojjjjjeeeeccccctttttkkkkkeeeeyyyyy"
export GOOGLE_APPLICATION_CREDENTIALS="/home/based/king/snakeman/project-name-420-twotimesaday.json"
export YOUTUBE_API_KEY="g3tth3k3y5fr0mth3w3b5it35"

# Directories
SOURCE_FOLDER="./source_material"
OLD_SOURCE_FOLDER="./finished_material/old_source_material"
PROJECT_FOLDER="./finished_material/project_final_clips"
TEST_FOLDER="./finished_material/test_material"
VENV_FOLDER="./venv"
TEMP_FOLDER="./temp"
FRAMES_FOLDER="$TEMP_FOLDER/frames"
TTS_OUTPUT_FOLDER="$TEMP_FOLDER/tts_outputs"
REQUIREMENTS_FILE="./text_files/requirements.txt"
REQUIREMENTS_CPU_FILE="./text_files/requirements_cpu.txt"

# Create necessary directories
mkdir -p $SOURCE_FOLDER $OLD_SOURCE_FOLDER $PROJECT_FOLDER $TEST_FOLDER $TEMP_FOLDER $FRAMES_FOLDER $TTS_OUTPUT_FOLDER

# Set up virtual environment
if [ ! -d "$VENV_FOLDER" ]; then
    python3 -m venv $VENV_FOLDER
    echo "Virtual environment created at $VENV_FOLDER"
fi

source $VENV_FOLDER/bin/activate
echo -e "\033[0;32mVirtual environment activated\033[0m"

# Display welcome banner
echo -e "\033[1;34m"
cat << "EOF"
  ______    __    __    ______    __    __   ________   __        __   ______    __    __                 ______    __        ______ 
 /      \  |  \  |  \  /      \  |  \  /  \ |        \ |  \     /  \  /      \  |  \  |  \               /      \  |  \      |      \
|  $$$$$$\ | $$\ | $$ |  $$$$$$\ | $$ /  $$ | $$$$$$$$ | $$\   /  $$ |  $$$$$$\ | $$\ | $$              |  $$$$$$\ | $$       \$$$$$$
| $$___\$$ | $$$\| $$ | $$__| $$ | $$/  $$  | $$__     | $$$\ /  $$$ | $$__| $$ | $$$\| $$    ______    | $$   \$$ | $$        | $$  
 \$$    \  | $$$$\ $$ | $$    $$ | $$  $$   | $$  \    | $$$$\  $$$$ | $$    $$ | $$$$\ $$   |      \   | $$       | $$        | $$  
 _\$$$$$$\ | $$\$$ $$ | $$$$$$$$ | $$$$$\   | $$$$$    | $$\$$ $$ $$ | $$$$$$$$ | $$\$$ $$    \$$$$$$   | $$   __  | $$        | $$  
|  \__| $$ | $$ \$$$$ | $$  | $$ | $$ \$$\  | $$_____  | $$ \$$$| $$ | $$  | $$ | $$ \$$$$              | $$__/  \ | $$_____  _| $$_ 
 \$$    $$ | $$  \$$$ | $$  | $$ | $$  \$$\ | $$     \ | $$  \$ | $$ | $$  | $$ | $$  \$$$               \$$    $$ | $$     \|   $$ \
  \$$$$$$   \$$   \$$  \$$   \$$  \$$   \$$  \$$$$$$$$  \$$      \$$  \$$   \$$  \$$   \$$                \$$$$$$   \$$$$$$$$ \$$$$$$
EOF
echo -e "\033[0m"

while true; do
    # Main menu
    echo "################################################################################################################"
    echo "################################################################################################################"
    echo "####################################               MAIN MENU                ####################################"
    echo "################################################################################################################"
    echo "###################################    Choose an option:                    ####################################"
    echo "###################################-----------------------------------------####################################"
    echo "###################################    1) Download mode                     ####################################"
    echo "###################################-----------------------------------------####################################"
    echo "###################################    2) Automated download and creation   ####################################"
    echo "###################################-----------------------------------------####################################"
    echo "###################################    3) Image captioner                   ####################################"
    echo "###################################-----------------------------------------####################################"
    echo "###################################    4) No TTS edit                       ####################################"
    echo "###################################-----------------------------------------####################################"
    echo "###################################    5) Warhammer                         ####################################"
    echo "###################################-----------------------------------------####################################"
    echo "###################################    6) TTS edit                          ####################################"
    echo "###################################-----------------------------------------####################################"
    echo "###################################    7) Thumbnail maker                   ####################################"
    echo "###################################-----------------------------------------####################################"
    echo "###################################    8) Dependency check                  ####################################"
    echo "###################################-----------------------------------------####################################"
    echo "###################################    9) Exit                              ####################################"
    echo "################################################################################################################"
    read -p "###################################    Enter your choice: " main_option

    case $main_option in
        1)
            echo "################################################################################################################"
            echo "################################################################################################################"
            echo "####################################          DOWNLOAD MODE SELECTED         ###################################"
            echo "################################################################################################################"
            echo "###################################    Choose the type of download:           ##################################"
            echo "###################################-------------------------------------------##################################"
            echo "###################################    1) Video downloader                    ##################################"
            echo "###################################-------------------------------------------##################################"
            echo "###################################    2) Image downloader                    ##################################"
            echo "###################################-------------------------------------------##################################"
            echo "################################################################################################################"
            read -p "###################################    Enter your choice: " download_option

            case $download_option in
                1)
                    echo "################################################################################################################"
                    echo "################################################################################################################"
                    echo "####################################   Enter the keyword (boxer name)         ##################################"
                    echo "###################################-------------------------------------------##################################"
                    echo "###################################         to search for videos:            ###################################"
                    echo "################################################################################################################"
                    read keyword
                    python scripts/video_downloader.py "$keyword"
                    ;;
                2)
                    echo "################################################################################################################"
                    echo "################################################################################################################"
                    echo "####################################   Enter the keyword (boxer name)         ##################################"
                    echo "###################################-------------------------------------------##################################"
                    echo "####################################         to search for images:            ##################################"
                    echo "################################################################################################################"
                    read keyword
                    python scripts/image_downloader.py "$keyword"
                    ;;
                *)
                    echo -e "\033[0;31m################################################################################################################\033[0m"
                    echo -e "\033[0;31m################################################################################################################\033[0m"
                    echo -e "\033[0;31m####################################        Invalid choice. Returning to menu...   ##################################\033[0m"
                    echo -e "\033[0;31m################################################################################################################\033[0m"
                    ;;
            esac
            ;;
        2)
            echo "################################################################################################################"
            echo "################################################################################################################"
            echo "####################################   Enter the keyword (boxer name)         ##################################"
            echo "###################################-------------------------------------------##################################"
            echo "####################################          to search for:                  ##################################"
            echo "################################################################################################################"
            read keyword
            python scripts/video_downloader.py "$keyword"
            if [ $? -eq 0 ]; then
                python scripts/snakeman.py "$SOURCE_FOLDER" "$OLD_SOURCE_FOLDER" "$PROJECT_FOLDER" "$FRAMES_FOLDER" "$TTS_OUTPUT_FOLDER"
            else
                echo -e "\033[0;31m################################################################################################################\033[0m"
                echo -e "\033[0;31m################################################################################################################\033[0m"
                echo -e "\033[0;31m####################################  Video download failed. Returning to menu...      ###################################\033[0m"
                echo -e "\033[0;31m################################################################################################################\033[0m"
            fi
            ;;
        3)
            echo "################################################################################################################"
            echo "################################################################################################################"
            echo "####################################        Image Captioner Selected         ###################################"
            echo "################################################################################################################"
            echo "#################################### Processing images in source folder      ###################################"
            echo "################################################################################################################"
            python scripts/image_captioner.py "$SOURCE_FOLDER"
            ;;
        4)
            echo "################################################################################################################"
            echo "################################################################################################################"
            echo "####################################        No TTS Edit Selected             ###################################"
            echo "################################################################################################################"
            echo "#################################### Processing videos in source folder      ###################################"
            echo "################################################################################################################"
            python scripts/snakeman_no_tts.py "$SOURCE_FOLDER" "$OLD_SOURCE_FOLDER" "$PROJECT_FOLDER"
            ;;
        5)
            echo "################################################################################################################"
            echo "################################################################################################################"
            echo "####################################        Warhammer Selected               ###################################"
            echo "################################################################################################################"
            echo "#################################### Processing Warhammer content            ###################################"
            echo "################################################################################################################"
            python scripts/warhammer.py "$SOURCE_FOLDER"
            ;;
        6)
            echo "################################################################################################################"
            echo "################################################################################################################"
            echo "####################################        TTS Edit Selected                 ##################################"
            echo "################################################################################################################"
            echo "#################################### Processing videos in source folder      ###################################"
            echo "################################################################################################################"
            python scripts/snakeman.py "$SOURCE_FOLDER" "$OLD_SOURCE_FOLDER" "$PROJECT_FOLDER" "$FRAMES_FOLDER" "$TTS_OUTPUT_FOLDER"
            ;;
        7)
            echo "################################################################################################################"
            echo "################################################################################################################"
            echo "####################################        Thumbnail Maker Selected          ##################################"
            echo "################################################################################################################"
            echo "#################################### Processing images for thumbnails        ###################################"
            echo "################################################################################################################"
            python scripts/thumbnail_maker.py
            ;;
        8)
            echo "################################################################################################################"
            echo "################################################################################################################"
            echo "####################################      Choose an option for dependencies:  ##################################"
            echo "####################################      1) General requirements            ###################################"
            echo "####################################      2) CPU-only requirements           ###################################"
            echo "################################################################################################################"
            read -p "###################################    Enter your choice: " dep_choice

            case $dep_choice in
                1)
                    pip install -r $REQUIREMENTS_FILE
                    ;;
                2)
                    pip install -r $REQUIREMENTS_CPU_FILE
                    ;;
                *)
                    echo -e "\033[0;31m################################################################################################################\033[0m"
                    echo -e "\033[0;31m################################################################################################################\033[0m"
                    echo -e "\033[0;31m####################################        Invalid choice. Returning to menu...        ###################################\033[0m"
                    echo -e "\033[0;31m################################################################################################################\033[0m"
                    ;;
            esac
            ;;
        9)
            echo -e "\033[0;32m################################################################################################################\033[0m"
            echo -e "\033[0;32m################################################################################################################\033[0m"
            echo -e "\033[0;32m####################################  Exiting...                           ####################################\033[0m"
            echo -e "\033[0;32m################################################################################################################\033[0m"
            echo -e "\033[0;32m################################################################################################################\033[0m"
            break
            ;;
        *)
            echo -e "\033[0;31m################################################################################################################\033[0m"
            echo -e "\033[0;31m################################################################################################################\033[0m"
            echo -e "\033[0;31m####################################        Invalid choice. Returning to menu...        ###################################\033[0m"
            echo -e "\033[0;31m################################################################################################################\033[0m"
            ;;
    esac
done

# Deactivate virtual environment
deactivate
echo -e "\033[0;32m################################################################################################################\033[0m"
echo -e "\033[0;32m################################################################################################################\033[0m"
echo -e "\033[0;32m####################################  Virtual environment deactivated       ####################################\033[0m"
echo -e "\033[0;32m################################################################################################################\033[0m"
echo -e "\033[0;32m################################################################################################################\033[0m"
